## 比特币的原理

### 比特币定义

1. 比特币系统是以去中心化信任为基础的。比特币网络不存在中央权威信任机构，“信任”成为了比特币用户之间存在的一种突出特征。

### 比特币交易 

交易是将钱从交易输入移至输出。输入是指钱币的来源，通常是之前一笔交易的输出。交易输出则是通过关联一个密钥的方式将钱赋予一个新的所有者。目的密钥被称为安全锁。这样就给资金强加了一个要求：有签名才能在以后的交易中赎回资金。一笔交易的输出可以被当做另一笔新交易的输入，这样随着钱从一个地址被移动带另一个地址的同时形成了一条所有权链



**比特币的所有权是通过数字密钥，比特币地址和数字签名来确定的。**

数字密钥实际上并不受存储在网络中，而是由用户生成并存储在一个文件或简单的数据库中，成为钱包。



## 技术角度看待区块链的正确姿势



区块链是 蕴含了技术与金融两层概念。从技术角度来看，这是个一个牺牲一致性效率且保证最终一致性的分布式的数据库。从经济学的角度来看，这种容错能力很强的点对点网络，恰恰满足了共享经济的一个必须要求 ----- 低成本的可信环境。



初次接触区块链：感觉都是成熟的技术，不就是分布式存储吗。但是仔细研究下会发现 这种片面的理解可能将对区块链的理解带入一个误区，作为一个技术人员忽略了区块链的经济学特征 ---- 一个权利分散且完全自治的系统。



区块链的本质是一个基于 P2P的价值传输协议，我们不能只看到P2P，而看不到价值传输。同样的也不能只看到价值传输，而看不到区块链的底层技术。



区块链更像一个交叉学科，结合了P2P 网络技术，非对称加密技术，宏观经济学， 经济学博弈等等知识， 构建的一个新领域----针对价值互联网的探索



强大的互联网给我门成本几乎为零的高速信息传递通道，却没有一个成本低廉可靠的高速价值传输通道



区块链是一个公共的分布式总账，下面从技术角度简单介绍一下：



想象有一个100台的分布式数据库集群，现在的情况是这100个节点实际上的拥有者是一个机构，并且所有节点处在该机构的**内网**当中，所以这个机构想让这100个数据库节点干嘛就干嘛，换句话说这**100个节点之间**是处于一个**可信任**的环境，并且受控于一个实体，这个实体具有**绝对仲裁分配权**。

另外的情况是这样的，想象这100个节点分别归不同的人所有，且每个人的节点数据都是一样的，即完全冗余，并且所有的节点是处在**广域网**当中，换句话说就是这100个**节点之间是不信任**的，且不存在一个实体，它拥有绝对仲裁权。



采用什么样的算法(共识模型) 能够提供一个可信任的环境，使：

1. 每个及诶单交换数据过程不被篡改；交换历史记录不可被篡改；
2. 每个节点的数据会同步到最新数据， 且承认经过共识的最新数据；
3. 基于少数服从多数的原则，整体节点维护的数据本身客观反应了交换历史。

区块链的本身就是 为了解决第二种情况的一种技术方案，更确切的说应该叫分布式的冗余的链式总帐本方案。

- 包含一个分布式数据库
- 分布式数据库的区块链的物理载体，区块链是交易的逻辑载体，所有核心节点都应包含该条区块链数据的全副本
- 区块链按时间序列化区块，且区块链是整个网络交易数据的唯一主体。
- 区块链只对添加有效，对其他操作无效
- 基于非对称加密的公私钥验证
- 记账节点要求拜占庭将军问题可解/避免
- 共识过程（consensus progress) 是演化稳定的，即面对一定量的不同节点的矛盾数据不会崩溃。
- 共识过程能够解决double-spending 问题。



比较主流的区块链平台（共有链，皆开源）：

- 比特币 Bitcoin
- 以太坊 Ethereum/ 经典以太坊 Ethereum Classic
- 以特股 Bitshares



![preview](https://pic4.zhimg.com/v2-44922876fe4a010eb00ae8e4bd5be7c3_r.jpg)

一个区块链 至少氛围三层：

**最底层**

是一些通用的基础模块， 比如 基础加密算法， 网络通讯库， 流处理，线程封装， 消息封装与解码，系统时间等；

**中间一层**

是区块链的核心模块，一般包含了区块链的主要逻辑，如P2P网络协议， 共识模块， 交易处理模块， 交易池模块， 简单合约或者智能合约模块，嵌入式数据库处理模块，钱包模块等等；

**最上面一层**

往往都是基于 Json Standard RPC 的交互模块，基于Json-RPC， 我们还可以做出更好的UI界面，也可以是一个web-service。

如果区块链 支持智能合约，可能还要分更多层，比如增加 BaaS 层， 区块链上的智能合约提供自治的服务，比如下面这张以太坊的构架图



![preview](https://pic2.zhimg.com/v2-6af2aaad40b476f177016e9133f72381_r.jpg)



比特币的设计：

![preview](https://pic3.zhimg.com/v2-6c66b5014bd22e307b8e8e8bfa6a6c7e_r.jpg)

Chain-paramters 描述了整个区块链的参数设置

wallet 是与地址/加密还有存储相关的

mem- pool 是未确认的交易池



无论哪种设计， 一般都要从P2P网络协议作为切入，作为一个P2P钱包， 既要提供Service也要提供 Client， 作为Service 依赖 P2P网络协议，作为Client依赖 Json-RPC



目前“三巨头“ 所使用的账户模型是不同的（所谓账户模型是指账户记账方法），比特币使用 UXTO模型， 以太坊和比特股使用账户余额模型。



UXTO模型（Unspent Transaction Outputs（UTXOs））：此模型表达了一种转换的概念，即任何产生的新币，在以后的生命周期中， 只有转移，没有消亡，转移实质上是由加密算法的签名与验证控制的：

![preview](https://pic1.zhimg.com/v2-a47a3829ac01ddd3e328688a5b960c94_r.jpg)

账户余额模型：账户余额模型摒弃了这种强验证的账户模型，即账户余额回归到数字加减，这样做提升了交易的效率。



**共识算法与分布式**

所谓区块链共识过程，是指如何将全网交易数据客观记录并且不可篡改的过程。

目前“三巨头”分别使用不同的共识算法（Consensus Algorithm），比特币使用工作量证明Pow（Proof of Work），以太坊即将转换为权益证明Pos（Proof of Stake），比特股使用授权权益证明 DPoS（Delegated Proof of Stake）。



这些算法 可以称为 “经济学”的算法， 所谓的经济学的算法，是指让作弊成本可计算， 且作弊成本远远大于作弊带来的收益， 即作弊无利可图， 通过这种思想构造一个用于节点之间博弈的算法，并使之趋向一个稳定的平衡。



相对应地我们还有计算机领域的分布式一致性算法。例如Paxos， Raft 我们也称为传统分布式 一致性算法。



我们之间的最大区别是：系统在拜占庭将军（Byzantine Generals Problem）情景下的可靠性， 即拜占庭容错（RBET算法支持拜占庭容错）。然而无论是Paxos 还是Raft 算法，理论上都可能会进入无法表决通过的死循环（尽管这个概率其实是非常非常低的），但是他们都是满足safety的，只是放松了liveness 的要求， PBFT 也是这样。



下面是一些传统分布式一致算法与区块链共识过程的异同点：

相同点：

- Append only
- 强调序列化
- 少数服从多数原则
- 分离覆盖的问题：即长链覆盖短链区块，多节点覆盖少数节点日志。

不同点：

- 传统分布式一致性算法大多不考虑拜占庭容错（Byzanetine Paxos 除外），即假设所有节点只会发生宕机，网络故障等非人为问题，并不考虑恶意节点篡改数据的问题。
- 传统分布式一致性算法是面向日志（数据库）的， 即更通用的情况，而区块链共识模型面向交易的，所以严格来说，传统分布式一致性算法应该处于区块链共识模型的下面一层。

考虑不同的点， 结合共有链和联盟链的特征，我们有：

- 联盟链：半封闭生态的交易网络，存在对等的不信任节点，如房产行业A，B，C，D公司。
- 公有链：开放生态的交易网络， 这层主要是为行业链和私有链提供全球交易网络。



由于联盟行业链其半封闭半开放特性，使用Delegated Proof of XXX 是可行的，可以考虑以传统一致性算法作为基础加入拜占庭容错/安全防护机制进行改进也是可以的。

而针对公有链，PoW/Pos/DPos等“经济学”的算法可能是最优算法。

技术上，以上不同的共识算法，我们很多新开发区块链都相应的支持一个特性：共识模块可插拔，以应对不同场景下的要求。

下图是一张未来区块链生态示意图：

![preview](https://pic2.zhimg.com/v2-e8d38226d37ff0004e36b3e105a3b69d_r.jpg)

公有链提供可信可靠的价值传输网络，上面可以继续组建去中心化应用（DAPP）或者部署联盟链，甚至传统数据库都行，在上层塔建C端应用。



**数字资产与价值流通网络**

![preview](https://pic2.zhimg.com/v2-f686485b723718f9b6913397711f443d_r.jpg)

“三巨头”中， 比特币在“数字货币”处，比特股在“去中心化交易所”附近， 以太坊在“去中心化组织”处。而实际上，区块链和现实的接触点，还在图示位置。



所以区块链仍是一个正在成长的少年， 结合图5 我们希望构建一个基础设备完善的价值传输网络，上层应用丰富的区块链生态，仍然需要付出巨大的努力。



下一步的目标，是将资产数字化（类比资产证劵话），例如我们可以将珍稀物品（艺术品/古董）数字化，知识产权数字化，票据基金等收益权数字化， 将极大的提升市场运作效率，配备智能合约，甚至人工智能，可编程社会不再是梦想。



想想互联网还需要什么？
正如比特币白皮书提到的， 一个点对点的现金系统， 他使用的前提要求是非常低的， 不需要注册， 不需要手机号，一个点对点的网络， 只要你用设备接入，那么你就可以使用。 区块链这个概念也一样，目的是构建一个点对点的生态，构建权利带来的不对称。它本身只是一个共享的总帐本，不同的网络中多节点自己记账，在对账，这就瓦解了中心权利。



